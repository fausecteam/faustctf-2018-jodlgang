name: JODLGANG
slug: jodlgang
author:
  - Bene <benedikt.lorch@fau.de>
  - Lukas <lukasdresel@ucsb.edu>

install:
  debian_packages:
    - build-essential
    - python3-dev
    - nginx-full
    - python3-pip
    - python3-setuptools
  postinst_commands:
    - ln -s /srv/jodlgang/jodlgang_nginx.conf /etc/nginx/sites-enabled/
    - chown -R jodlgang:jodlgang /srv/jodlgang/jodlgang # Give uwsgi process permissions to run as uid jodlgang
    - chmod 751 /srv/jodlgang # Give nginx permission to traverse into static files directory
    - chmod 640 /srv/jodlgang/jodlgang/db.sqlite3 # Prevent other services from reading the database
    - pip3 install wheel
    - pip3 install uwsgi
    - mv /srv/jodlgang/uwsgi.service /etc/systemd/system/uwsgi.service  # systemd script for uWSGI
    - mkdir -p /etc/uwsgi/sites # Create directory for site configurations
    - mv /srv/jodlgang/jodlgang_uwsgi.ini /etc/uwsgi/sites/ # uWSGI configuration for jodlgang service
    - systemctl daemon-reload # Refresh systemd with new uWSGI service on board
    - systemctl start uwsgi # Start the script
    - systemctl enable uwsgi # Start uWSGI after reboot
  prevent_outgoing_connections: True

checker:
  module: jodlgang
  class: JodlGangChecker
  debian_packages:
    - python3
    - python3-requests
    - python3-bs4